<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆªé¢æ³•æ±‚ä½“ç§¯ - äº¤äº’å¼å¯è§†åŒ–</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .card h2 {
            color: #333;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 20px;
        }
        .control-group {
            flex: 1;
            min-width: 200px;
        }
        .control-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }
        select, input[type="range"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }
        .canvas-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .canvas-container {
                grid-template-columns: 1fr;
            }
        }
        .canvas-box {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
        }
        .canvas-box h3 {
            text-align: center;
            color: #333;
            margin-bottom: 12px;
        }
        canvas {
            display: block;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .info-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        .formula {
            background: #fff;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Times New Roman', serif;
            font-size: 18px;
            text-align: center;
            margin: 12px 0;
            border-left: 4px solid #667eea;
        }
        .slider-value {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            margin-left: 8px;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 12px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        /* çŸ¥è¯†ç‚¹æ ·å¼ */
        .knowledge-section {
            margin-bottom: 24px;
        }
        .knowledge-section h3 {
            color: #667eea;
            font-size: 18px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px dashed #e0e0e0;
        }
        .knowledge-box {
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
            border-radius: 12px;
            padding: 16px 20px;
            border-left: 4px solid #667eea;
        }
        .knowledge-box p {
            margin: 8px 0;
            line-height: 1.6;
        }
        .knowledge-box .formula {
            background: white;
            margin: 12px 0;
        }
        .knowledge-box .formula.small {
            font-size: 16px;
            padding: 10px;
        }
        .formula-explain {
            font-size: 14px;
            color: #666;
            margin-top: 8px !important;
        }
        .formula-explain .highlight {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            color: #856404;
        }
        .knowledge-box.two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 600px) {
            .knowledge-box.two-column {
                grid-template-columns: 1fr;
            }
        }
        .knowledge-box .column {
            background: white;
            padding: 12px;
            border-radius: 8px;
        }
        .knowledge-box .note {
            font-size: 13px;
            color: #888;
            margin-top: 8px;
        }

        /* å…¬å¼å¡ç‰‡ */
        .formula-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }
        @media (max-width: 768px) {
            .formula-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        .formula-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .formula-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 12px 30px rgba(102,126,234,0.35);
            border-color: #667eea;
            background: linear-gradient(135deg, #ffffff 0%, #f0f4ff 100%);
        }
        .formula-card:hover .shape-icon {
            transform: scale(1.2);
            color: #764ba2;
        }
        .formula-card:hover .shape-formula {
            transform: scale(1.05);
        }
        .shape-icon {
            font-size: 32px;
            color: #667eea;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        .shape-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .shape-formula {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px;
            border-radius: 6px;
            font-family: 'Times New Roman', serif;
            font-size: 16px;
            margin-bottom: 6px;
            transition: all 0.3s ease;
        }
        .shape-note {
            font-size: 12px;
            color: #888;
        }

        /* æ­¥éª¤æ¡† */
        .steps-box {
            display: flex;
            gap: 16px;
        }
        @media (max-width: 768px) {
            .steps-box {
                flex-direction: column;
            }
        }
        .step {
            flex: 1;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            background: white;
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .step:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(102,126,234,0.25);
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
        }
        .step:hover .step-num {
            transform: scale(1.15) rotate(10deg);
            box-shadow: 0 4px 15px rgba(102,126,234,0.4);
        }
        .step-num {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }
        .step-content {
            font-size: 14px;
            line-height: 1.5;
        }

        /* FAQ */
        .faq-box {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
        }
        .faq-item {
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e9ecef;
            padding: 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .faq-item:hover {
            background: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transform: translateX(5px);
        }
        .faq-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }
        .faq-q {
            font-weight: 600;
            color: #e74c3c;
            margin-bottom: 6px;
            transition: color 0.3s ease;
        }
        .faq-item:hover .faq-q {
            color: #c0392b;
        }
        .faq-a {
            color: #555;
            padding-left: 20px;
            border-left: 3px solid #27ae60;
            transition: all 0.3s ease;
        }
        .faq-item:hover .faq-a {
            border-left-width: 5px;
            padding-left: 22px;
        }

        /* çŸ¥è¯†æ¡†åŠ¨ç”» */
        .knowledge-box {
            transition: all 0.3s ease;
        }
        .knowledge-box:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 20px rgba(102,126,234,0.15);
        }
        .knowledge-section h3 {
            transition: all 0.3s ease;
        }
        .knowledge-section:hover h3 {
            color: #764ba2;
            padding-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æˆªé¢æ³•æ±‚ä½“ç§¯ - äº¤äº’å¼å¯è§†åŒ–</h1>

        <div class="card">
            <h2>æ§åˆ¶é¢æ¿</h2>
            <div class="controls">
                <div class="control-group">
                    <label>é€‰æ‹©æˆªé¢ç±»å‹ï¼š</label>
                    <select id="sectionType">
                        <option value="equilateral">a) ç­‰è¾¹ä¸‰è§’å½¢ (å‚ç›´äºxè½´)</option>
                        <option value="semicircle">b) åŠåœ† (å‚ç›´äºxè½´)</option>
                        <option value="isosceles">c) ç­‰è…°ç›´è§’ä¸‰è§’å½¢ (å‚ç›´äºyè½´)</option>
                        <option value="square">d) æ­£æ–¹å½¢ (å‚ç›´äºyè½´)</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>åˆ‡ç‰‡ä½ç½®ï¼š<span class="slider-value" id="posValue">0</span></label>
                    <input type="range" id="slicePos" min="-50" max="50" value="0">
                </div>
            </div>
        </div>

        <div class="card">
            <h2>å¯è§†åŒ–</h2>
            <div class="canvas-container">
                <div class="canvas-box">
                    <h3>ä¿¯è§†å›¾ (æ¤­åœ†åº•é¢)</h3>
                    <canvas id="topView" width="400" height="300"></canvas>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #667eea;"></div>
                            <span>æ¤­åœ†è¾¹ç•Œ</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #e74c3c;"></div>
                            <span>åˆ‡ç‰‡ä½ç½®</span>
                        </div>
                    </div>
                </div>
                <div class="canvas-box">
                    <h3>æˆªé¢å½¢çŠ¶</h3>
                    <canvas id="sectionView" width="400" height="300"></canvas>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #2ecc71;"></div>
                            <span>æˆªé¢</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>3D ç«‹ä½“é¢„è§ˆ</h2>
            <div style="text-align: center;">
                <canvas id="view3d" width="600" height="450"></canvas>
            </div>
        </div>

        <div class="card">
            <h2>è®¡ç®—è¿‡ç¨‹</h2>
            <div class="info-box" id="calcInfo">
                <!-- åŠ¨æ€å¡«å…… -->
            </div>
        </div>

        <div class="card">
            <h2>ğŸ“š çŸ¥è¯†ç‚¹è¯¦è§£</h2>

            <div class="knowledge-section">
                <h3>ä¸€ã€ä»€ä¹ˆæ˜¯æˆªé¢æ³•ï¼Ÿ</h3>
                <div class="knowledge-box">
                    <p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong>æŠŠç«‹ä½“åˆ‡æˆæ— æ•°è–„ç‰‡ï¼Œæ¯ç‰‡é¢ç§¯çŸ¥é“ï¼Œåšåº¦æ— é™è–„ï¼Œå…¨éƒ¨åŠ èµ·æ¥å°±æ˜¯ä½“ç§¯ã€‚</p>
                    <div class="formula">V = âˆ«<sub>a</sub><sup>b</sup> A(x) dx</div>
                    <p class="formula-explain">
                        <span class="highlight">A(x)</span> = åœ¨ä½ç½® x å¤„çš„æˆªé¢é¢ç§¯<br>
                        <span class="highlight">dx</span> = æ¯ç‰‡çš„åšåº¦ï¼ˆæ— é™è–„ï¼‰<br>
                        <span class="highlight">âˆ«</span> = æŠŠæ‰€æœ‰è–„ç‰‡"åŠ èµ·æ¥"
                    </p>
                </div>
            </div>

            <div class="knowledge-section">
                <h3>äºŒã€æœ¬é¢˜çš„æ¤­åœ†åº•é¢</h3>
                <div class="knowledge-box">
                    <p><strong>åŸæ–¹ç¨‹ï¼š</strong>4xÂ² + 25yÂ² = 100</p>
                    <p><strong>æ ‡å‡†å½¢å¼ï¼š</strong></p>
                    <div class="formula">xÂ²/25 + yÂ²/4 = 1 â†’ xÂ²/5Â² + yÂ²/2Â² = 1</div>
                    <p class="formula-explain">
                        â€¢ x æ–¹å‘ï¼šä» <span class="highlight">-5</span> åˆ° <span class="highlight">+5</span>ï¼ˆé•¿è½´ï¼‰<br>
                        â€¢ y æ–¹å‘ï¼šä» <span class="highlight">-2</span> åˆ° <span class="highlight">+2</span>ï¼ˆçŸ­è½´ï¼‰
                    </p>
                </div>
            </div>

            <div class="knowledge-section">
                <h3>ä¸‰ã€å¼¦é•¿å…¬å¼ï¼ˆæœ€å…³é”®ï¼ï¼‰</h3>
                <div class="knowledge-box two-column">
                    <div class="column">
                        <p><strong>å‚ç›´äº x è½´åˆ‡ï¼š</strong></p>
                        <div class="formula small">å¼¦é•¿ = (4/5)âˆš(25-xÂ²)</div>
                        <p class="note">ç§¯åˆ†èŒƒå›´ï¼šx âˆˆ [-5, 5]</p>
                    </div>
                    <div class="column">
                        <p><strong>å‚ç›´äº y è½´åˆ‡ï¼š</strong></p>
                        <div class="formula small">å¼¦é•¿ = 5âˆš(4-yÂ²)</div>
                        <p class="note">ç§¯åˆ†èŒƒå›´ï¼šy âˆˆ [-2, 2]</p>
                    </div>
                </div>
            </div>

            <div class="knowledge-section">
                <h3>å››ã€å¿…èƒŒé¢ç§¯å…¬å¼</h3>
                <div class="formula-cards">
                    <div class="formula-card">
                        <div class="shape-icon">â–³</div>
                        <div class="shape-name">ç­‰è¾¹ä¸‰è§’å½¢</div>
                        <div class="shape-formula">A = (âˆš3/4)sÂ²</div>
                        <div class="shape-note">s = è¾¹é•¿</div>
                    </div>
                    <div class="formula-card">
                        <div class="shape-icon">â——</div>
                        <div class="shape-name">åŠåœ†</div>
                        <div class="shape-formula">A = (Ï€/2)rÂ²</div>
                        <div class="shape-note">r = åŠå¾„ = ç›´å¾„/2</div>
                    </div>
                    <div class="formula-card">
                        <div class="shape-icon">â—º</div>
                        <div class="shape-name">ç­‰è…°ç›´è§’ä¸‰è§’å½¢</div>
                        <div class="shape-formula">A = hÂ²/4</div>
                        <div class="shape-note">h = æ–œè¾¹ï¼ˆåº•ï¼‰</div>
                    </div>
                    <div class="formula-card">
                        <div class="shape-icon">â–¡</div>
                        <div class="shape-name">æ­£æ–¹å½¢</div>
                        <div class="shape-formula">A = sÂ²</div>
                        <div class="shape-note">s = è¾¹é•¿</div>
                    </div>
                </div>
            </div>

            <div class="knowledge-section">
                <h3>äº”ã€è§£é¢˜ä¸‰æ­¥æ³•</h3>
                <div class="steps-box">
                    <div class="step">
                        <div class="step-num">1</div>
                        <div class="step-content">
                            <strong>æ‰¾æˆªé¢çš„"è¾¹"</strong><br>
                            è¾¹ = æ¤­åœ†åœ¨è¯¥ä½ç½®çš„å¼¦é•¿
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-num">2</div>
                        <div class="step-content">
                            <strong>ä»£å…¥é¢ç§¯å…¬å¼</strong><br>
                            ç”¨å¼¦é•¿è¡¨è¾¾å¼è®¡ç®— A(x) æˆ– A(y)
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-num">3</div>
                        <div class="step-content">
                            <strong>å†™å‡ºç§¯åˆ†</strong><br>
                            ç¡®å®šç§¯åˆ†å˜é‡å’Œä¸Šä¸‹é™
                        </div>
                    </div>
                </div>
            </div>

            <div class="knowledge-section">
                <h3>å…­ã€å¸¸è§é—®é¢˜</h3>
                <div class="faq-box">
                    <div class="faq-item">
                        <div class="faq-q">Q: æ€ä¹ˆåˆ¤æ–­ç”¨ x è¿˜æ˜¯ y ç§¯åˆ†ï¼Ÿ</div>
                        <div class="faq-a">A: çœ‹é¢˜ç›®è¯´"å‚ç›´äºå“ªä¸ªè½´"ã€‚å‚ç›´äº x è½´ â†’ å¯¹ x ç§¯åˆ†ï¼›å‚ç›´äº y è½´ â†’ å¯¹ y ç§¯åˆ†ã€‚</div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-q">Q: ç§¯åˆ†ä¸Šä¸‹é™æ€ä¹ˆç¡®å®šï¼Ÿ</div>
                        <div class="faq-a">A: çœ‹æ¤­åœ†åœ¨é‚£ä¸ªæ–¹å‘çš„èŒƒå›´ã€‚x æ–¹å‘æ˜¯ [-5, 5]ï¼Œy æ–¹å‘æ˜¯ [-2, 2]ã€‚</div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-q">Q: ç­‰è…°ç›´è§’ä¸‰è§’å½¢çš„"æ–œè¾¹ä¸ºåº•"æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</div>
                        <div class="faq-a">A: ä¸‰è§’å½¢å€’è¿‡æ¥æ”¾ï¼Œæ–œè¾¹æœä¸‹å½“åº•è¾¹ï¼Œç›´è§’é¡¶ç‚¹æœä¸Šã€‚é¢ç§¯ = æ–œè¾¹Â²/4ã€‚</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¤­åœ†å‚æ•°
        const a = 5;  // xæ–¹å‘åŠè½´
        const b = 2;  // yæ–¹å‘åŠè½´

        // è·å–å…ƒç´ 
        const sectionType = document.getElementById('sectionType');
        const slicePos = document.getElementById('slicePos');
        const posValue = document.getElementById('posValue');
        const topCanvas = document.getElementById('topView');
        const sectionCanvas = document.getElementById('sectionView');
        const canvas3d = document.getElementById('view3d');
        const calcInfo = document.getElementById('calcInfo');

        const topCtx = topCanvas.getContext('2d');
        const sectionCtx = sectionCanvas.getContext('2d');
        const ctx3d = canvas3d.getContext('2d');

        // æ›´æ–°æ˜¾ç¤º
        function update() {
            const type = sectionType.value;
            const pos = slicePos.value / 10;  // è½¬æ¢ä¸ºå®é™…åæ ‡

            // æ ¹æ®ç±»å‹è°ƒæ•´æ»‘å—èŒƒå›´å’Œæ˜¾ç¤º
            if (type === 'equilateral' || type === 'semicircle') {
                slicePos.min = -50;
                slicePos.max = 50;
                posValue.textContent = `x = ${pos.toFixed(1)}`;
            } else {
                slicePos.min = -20;
                slicePos.max = 20;
                posValue.textContent = `y = ${pos.toFixed(1)}`;
            }

            drawTopView(type, pos);
            drawSectionView(type, pos);
            draw3DView(type);
            updateCalcInfo(type, pos);
        }

        // ç»˜åˆ¶ä¿¯è§†å›¾
        function drawTopView(type, pos) {
            const ctx = topCtx;
            const w = topCanvas.width;
            const h = topCanvas.height;
            const cx = w / 2;
            const cy = h / 2;
            const scale = 35;

            ctx.clearRect(0, 0, w, h);

            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#ccc';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, cy);
            ctx.lineTo(w, cy);
            ctx.moveTo(cx, 0);
            ctx.lineTo(cx, h);
            ctx.stroke();

            // ç»˜åˆ¶åˆ»åº¦
            ctx.fillStyle = '#999';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            for (let i = -5; i <= 5; i++) {
                if (i !== 0) {
                    ctx.fillText(i, cx + i * scale, cy + 15);
                }
            }
            ctx.textAlign = 'right';
            for (let i = -2; i <= 2; i++) {
                if (i !== 0) {
                    ctx.fillText(i, cx - 5, cy - i * scale + 4);
                }
            }
            ctx.fillText('x', w - 10, cy - 5);
            ctx.fillText('y', cx + 15, 15);

            // ç»˜åˆ¶æ¤­åœ†
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.ellipse(cx, cy, a * scale, b * scale, 0, 0, 2 * Math.PI);
            ctx.stroke();

            // ç»˜åˆ¶åˆ‡ç‰‡çº¿
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();

            if (type === 'equilateral' || type === 'semicircle') {
                // å‚ç›´äºxè½´çš„åˆ‡ç‰‡
                const x = cx + pos * scale;
                if (Math.abs(pos) <= a) {
                    const yVal = b * Math.sqrt(1 - (pos * pos) / (a * a));
                    ctx.moveTo(x, cy - yVal * scale);
                    ctx.lineTo(x, cy + yVal * scale);
                }
            } else {
                // å‚ç›´äºyè½´çš„åˆ‡ç‰‡
                const y = cy - pos * scale;
                if (Math.abs(pos) <= b) {
                    const xVal = a * Math.sqrt(1 - (pos * pos) / (b * b));
                    ctx.moveTo(cx - xVal * scale, y);
                    ctx.lineTo(cx + xVal * scale, y);
                }
            }
            ctx.stroke();
            ctx.setLineDash([]);

            // æ ‡æ³¨å¼¦é•¿
            ctx.fillStyle = '#e74c3c';
            ctx.font = 'bold 14px Arial';
            if (type === 'equilateral' || type === 'semicircle') {
                if (Math.abs(pos) <= a) {
                    const chord = 2 * b * Math.sqrt(1 - (pos * pos) / (a * a));
                    ctx.fillText(`å¼¦é•¿ = ${chord.toFixed(2)}`, cx + pos * scale + 10, cy - 50);
                }
            } else {
                if (Math.abs(pos) <= b) {
                    const chord = 2 * a * Math.sqrt(1 - (pos * pos) / (b * b));
                    ctx.fillText(`å¼¦é•¿ = ${chord.toFixed(2)}`, cx + 50, cy - pos * scale - 10);
                }
            }
        }

        // ç»˜åˆ¶æˆªé¢
        function drawSectionView(type, pos) {
            const ctx = sectionCtx;
            const w = sectionCanvas.width;
            const h = sectionCanvas.height;
            const cx = w / 2;
            const cy = h - 50;
            const scale = 50;

            ctx.clearRect(0, 0, w, h);

            let chord = 0;
            if (type === 'equilateral' || type === 'semicircle') {
                if (Math.abs(pos) <= a) {
                    chord = 2 * b * Math.sqrt(1 - (pos * pos) / (a * a));
                }
            } else {
                if (Math.abs(pos) <= b) {
                    chord = 2 * a * Math.sqrt(1 - (pos * pos) / (b * b));
                }
            }

            if (chord <= 0) {
                ctx.fillStyle = '#999';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('åˆ‡ç‰‡ä½ç½®è¶…å‡ºæ¤­åœ†èŒƒå›´', cx, h / 2);
                return;
            }

            ctx.fillStyle = 'rgba(46, 204, 113, 0.3)';
            ctx.strokeStyle = '#2ecc71';
            ctx.lineWidth = 3;

            const halfChord = chord * scale / 2;

            ctx.beginPath();
            switch (type) {
                case 'equilateral':
                    // ç­‰è¾¹ä¸‰è§’å½¢
                    const triHeight = halfChord * Math.sqrt(3);
                    ctx.moveTo(cx - halfChord, cy);
                    ctx.lineTo(cx + halfChord, cy);
                    ctx.lineTo(cx, cy - triHeight);
                    ctx.closePath();
                    break;

                case 'semicircle':
                    // åŠåœ†
                    ctx.arc(cx, cy, halfChord, Math.PI, 0);
                    ctx.closePath();
                    break;

                case 'isosceles':
                    // ç­‰è…°ç›´è§’ä¸‰è§’å½¢ï¼ˆæ–œè¾¹ä¸ºåº•ï¼‰
                    const legLength = chord / Math.sqrt(2) * scale / 2;
                    ctx.moveTo(cx - halfChord, cy);
                    ctx.lineTo(cx + halfChord, cy);
                    ctx.lineTo(cx + halfChord, cy - legLength * 2);
                    ctx.closePath();
                    break;

                case 'square':
                    // æ­£æ–¹å½¢
                    ctx.rect(cx - halfChord, cy - chord * scale, chord * scale, chord * scale);
                    break;
            }
            ctx.fill();
            ctx.stroke();

            // æ ‡æ³¨å°ºå¯¸
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`åº•è¾¹/è¾¹é•¿ = ${chord.toFixed(2)}`, cx, cy + 30);

            // è®¡ç®—é¢ç§¯
            let area = 0;
            let areaFormula = '';
            switch (type) {
                case 'equilateral':
                    area = Math.sqrt(3) / 4 * chord * chord;
                    areaFormula = `A = (âˆš3/4)Ã—${chord.toFixed(2)}Â² = ${area.toFixed(2)}`;
                    break;
                case 'semicircle':
                    area = Math.PI / 2 * (chord / 2) * (chord / 2);
                    areaFormula = `A = (Ï€/2)Ã—(${(chord/2).toFixed(2)})Â² = ${area.toFixed(2)}`;
                    break;
                case 'isosceles':
                    area = chord * chord / 4;
                    areaFormula = `A = ${chord.toFixed(2)}Â²/4 = ${area.toFixed(2)}`;
                    break;
                case 'square':
                    area = chord * chord;
                    areaFormula = `A = ${chord.toFixed(2)}Â² = ${area.toFixed(2)}`;
                    break;
            }
            ctx.fillStyle = '#667eea';
            ctx.font = 'bold 16px Arial';
            ctx.fillText(areaFormula, cx, 30);
        }

        // 3DæŠ•å½±å‡½æ•° - ç­‰è½´æµ‹æŠ•å½±
        // åæ ‡ç³»ï¼šx-yå¹³é¢æ˜¯æ¤­åœ†åº•é¢ï¼Œzæ˜¯é«˜åº¦æ–¹å‘ï¼ˆå‘ä¸Šï¼‰
        function project3D(x, y, z, cx, cy, scale) {
            // ç­‰è½´æµ‹æŠ•å½±ï¼šxå‘å³å‰ï¼Œyå‘å³åï¼Œzå‘ä¸Š
            const angleX = Math.PI / 6;  // xè½´è§’åº¦ 30åº¦
            const angleY = Math.PI / 6;  // yè½´è§’åº¦ 30åº¦

            // å±å¹•åæ ‡è®¡ç®—
            const screenX = cx + (x * Math.cos(angleX) + y * Math.cos(Math.PI - angleY)) * scale;
            const screenY = cy - z * scale + (x * Math.sin(angleX) + y * Math.sin(Math.PI - angleY)) * scale * 0.5;

            return { x: screenX, y: screenY };
        }

        // ç»˜åˆ¶3Dè§†å›¾
        function draw3DView(type) {
            const ctx = ctx3d;
            const w = canvas3d.width;
            const h = canvas3d.height;

            ctx.clearRect(0, 0, w, h);

            // ç»˜åˆ¶æ¸å˜èƒŒæ™¯
            const bgGrad = ctx.createLinearGradient(0, 0, 0, h);
            bgGrad.addColorStop(0, '#f8f9fa');
            bgGrad.addColorStop(1, '#e9ecef');
            ctx.fillStyle = bgGrad;
            ctx.fillRect(0, 0, w, h);

            const cx = w / 2;
            const cy = h / 2 + 80;
            const scale = 28;

            // æ ‡é¢˜
            ctx.fillStyle = '#333';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            const titles = {
                'equilateral': 'ç­‰è¾¹ä¸‰è§’å½¢æˆªé¢ç«‹ä½“ (å‚ç›´äºxè½´)',
                'semicircle': 'åŠåœ†æˆªé¢ç«‹ä½“ (å‚ç›´äºxè½´)',
                'isosceles': 'ç­‰è…°ç›´è§’ä¸‰è§’å½¢æˆªé¢ç«‹ä½“ (å‚ç›´äºyè½´)',
                'square': 'æ­£æ–¹å½¢æˆªé¢ç«‹ä½“ (å‚ç›´äºyè½´)'
            };
            ctx.fillText(titles[type], cx, 25);

            // ç»˜åˆ¶3Dç½‘æ ¼åº•é¢ (x-yå¹³é¢)
            ctx.strokeStyle = 'rgba(150, 150, 150, 0.2)';
            ctx.lineWidth = 0.5;
            for (let i = -6; i <= 6; i++) {
                let p1 = project3D(i, -3, 0, cx, cy, scale);
                let p2 = project3D(i, 3, 0, cx, cy, scale);
                ctx.beginPath();
                ctx.moveTo(p1.x, p1.y);
                ctx.lineTo(p2.x, p2.y);
                ctx.stroke();
            }
            for (let j = -3; j <= 3; j++) {
                let p1 = project3D(-6, j, 0, cx, cy, scale);
                let p2 = project3D(6, j, 0, cx, cy, scale);
                ctx.beginPath();
                ctx.moveTo(p1.x, p1.y);
                ctx.lineTo(p2.x, p2.y);
                ctx.stroke();
            }

            // ç»˜åˆ¶åæ ‡è½´
            ctx.lineWidth = 2.5;

            // Xè½´ (çº¢è‰²) - æ¤­åœ†é•¿è½´æ–¹å‘
            let p1 = project3D(0, 0, 0, cx, cy, scale);
            let p2 = project3D(6, 0, 0, cx, cy, scale);
            ctx.strokeStyle = '#e74c3c';
            ctx.beginPath();
            ctx.moveTo(p1.x, p1.y);
            ctx.lineTo(p2.x, p2.y);
            ctx.stroke();
            ctx.fillStyle = '#c0392b';
            ctx.font = 'bold 14px Arial';
            ctx.fillText('x', p2.x + 8, p2.y + 12);

            // Yè½´ (è“è‰²) - æ¤­åœ†çŸ­è½´æ–¹å‘
            p2 = project3D(0, 3, 0, cx, cy, scale);
            ctx.strokeStyle = '#3498db';
            ctx.beginPath();
            ctx.moveTo(p1.x, p1.y);
            ctx.lineTo(p2.x, p2.y);
            ctx.stroke();
            ctx.fillStyle = '#2980b9';
            ctx.fillText('y', p2.x - 15, p2.y + 5);

            // Zè½´ (ç»¿è‰²) - é«˜åº¦æ–¹å‘
            p2 = project3D(0, 0, 6, cx, cy, scale);
            ctx.strokeStyle = '#27ae60';
            ctx.beginPath();
            ctx.moveTo(p1.x, p1.y);
            ctx.lineTo(p2.x, p2.y);
            ctx.stroke();
            ctx.fillStyle = '#1e8449';
            ctx.fillText('z(é«˜åº¦)', p2.x + 5, p2.y - 5);

            // ç»˜åˆ¶æ¤­åœ†åº•é¢ (x-yå¹³é¢, z=0)
            ctx.beginPath();
            for (let t = 0; t <= 2 * Math.PI; t += 0.02) {
                const ex = a * Math.cos(t);  // xæ–¹å‘: -5 åˆ° 5
                const ey = b * Math.sin(t);  // yæ–¹å‘: -2 åˆ° 2
                const p = project3D(ex, ey, 0, cx, cy, scale);
                if (t === 0) {
                    ctx.moveTo(p.x, p.y);
                } else {
                    ctx.lineTo(p.x, p.y);
                }
            }
            ctx.closePath();

            // æ¤­åœ†åº•é¢æ¸å˜
            const ellipseGrad = ctx.createRadialGradient(cx, cy, 0, cx, cy, 200);
            ellipseGrad.addColorStop(0, 'rgba(102, 126, 234, 0.25)');
            ellipseGrad.addColorStop(1, 'rgba(102, 126, 234, 0.05)');
            ctx.fillStyle = ellipseGrad;
            ctx.fill();
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 2.5;
            ctx.stroke();

            // æ ¹æ®ç±»å‹ç»˜åˆ¶å®å¿ƒç«‹ä½“
            if (type === 'equilateral' || type === 'semicircle') {
                // å‚ç›´äºxè½´ï¼šæ²¿xæ–¹å‘åˆ‡ç‰‡ï¼Œæˆªé¢åœ¨y-zå¹³é¢
                drawSolid3D_perpX(ctx, type, cx, cy, scale);
            } else {
                // å‚ç›´äºyè½´ï¼šæ²¿yæ–¹å‘åˆ‡ç‰‡ï¼Œæˆªé¢åœ¨x-zå¹³é¢
                drawSolid3D_perpY(ctx, type, cx, cy, scale);
            }
        }

        // ç»˜åˆ¶å‚ç›´äºXè½´çš„ç«‹ä½“ï¼ˆç­‰è¾¹ä¸‰è§’å½¢/åŠåœ†ï¼‰
        // æˆªé¢åœ¨ y-z å¹³é¢ï¼Œæ²¿ x æ–¹å‘å †å 
        function drawSolid3D_perpX(ctx, type, cx, cy, scale) {
            const steps = 60;

            // åœ¨æ¯ä¸ªxä½ç½®ï¼Œyçš„èŒƒå›´æ˜¯ Â±(2/5)âˆš(25-xÂ²)
            // æˆªé¢çš„åº•è¾¹ï¼ˆå¼¦é•¿ï¼‰= (4/5)âˆš(25-xÂ²)

            // æ”¶é›†è½®å»“ç‚¹
            const topPoints = [];      // æˆªé¢é¡¶ç‚¹è½¨è¿¹
            const frontPoints = [];    // y > 0 ä¾§çš„åº•è¾¹
            const backPoints = [];     // y < 0 ä¾§çš„åº•è¾¹

            for (let i = 0; i <= steps; i++) {
                const t = i / steps;
                const x = -a + t * 2 * a;
                const yMax = (2/5) * Math.sqrt(Math.max(0, 25 - x * x));
                const chord = 2 * yMax;  // å¼¦é•¿

                let topZ = 0;
                if (type === 'equilateral') {
                    topZ = chord * Math.sqrt(3) / 2;  // ç­‰è¾¹ä¸‰è§’å½¢é«˜åº¦
                } else {
                    topZ = chord / 2;  // åŠåœ†åŠå¾„
                }

                topPoints.push(project3D(x, 0, topZ, cx, cy, scale));
                frontPoints.push(project3D(x, yMax, 0, cx, cy, scale));
                backPoints.push(project3D(x, -yMax, 0, cx, cy, scale));
            }

            // ç»˜åˆ¶èƒŒé¢ï¼ˆy < 0 ä¾§åˆ°é¡¶éƒ¨ï¼‰
            ctx.beginPath();
            for (let i = 0; i <= steps; i++) {
                const p = backPoints[i];
                if (i === 0) ctx.moveTo(p.x, p.y);
                else ctx.lineTo(p.x, p.y);
            }
            for (let i = steps; i >= 0; i--) {
                const p = topPoints[i];
                ctx.lineTo(p.x, p.y);
            }
            ctx.closePath();

            const backGrad = ctx.createLinearGradient(cx - 100, cy, cx + 100, cy - 150);
            backGrad.addColorStop(0, 'rgba(46, 204, 113, 0.35)');
            backGrad.addColorStop(1, 'rgba(39, 174, 96, 0.55)');
            ctx.fillStyle = backGrad;
            ctx.fill();
            ctx.strokeStyle = 'rgba(39, 174, 96, 0.5)';
            ctx.lineWidth = 1;
            ctx.stroke();

            // ç»˜åˆ¶å‰é¢ï¼ˆy > 0 ä¾§åˆ°é¡¶éƒ¨ï¼‰
            ctx.beginPath();
            for (let i = 0; i <= steps; i++) {
                const p = frontPoints[i];
                if (i === 0) ctx.moveTo(p.x, p.y);
                else ctx.lineTo(p.x, p.y);
            }
            for (let i = steps; i >= 0; i--) {
                const p = topPoints[i];
                ctx.lineTo(p.x, p.y);
            }
            ctx.closePath();

            const frontGrad = ctx.createLinearGradient(cx - 100, cy + 50, cx + 100, cy - 150);
            frontGrad.addColorStop(0, 'rgba(46, 204, 113, 0.5)');
            frontGrad.addColorStop(1, 'rgba(88, 214, 141, 0.75)');
            ctx.fillStyle = frontGrad;
            ctx.fill();
            ctx.strokeStyle = 'rgba(39, 174, 96, 0.7)';
            ctx.lineWidth = 1.5;
            ctx.stroke();

            // é¡¶éƒ¨è½®å»“çº¿ï¼ˆè„Šçº¿ï¼‰
            ctx.beginPath();
            for (let i = 0; i <= steps; i++) {
                const p = topPoints[i];
                if (i === 0) ctx.moveTo(p.x, p.y);
                else ctx.lineTo(p.x, p.y);
            }
            ctx.strokeStyle = '#27ae60';
            ctx.lineWidth = 3;
            ctx.stroke();

            // ç»˜åˆ¶å‡ ä¸ªä»£è¡¨æ€§çš„æˆªé¢
            const slicePositions = [-3.5, 0, 3.5];
            for (const x of slicePositions) {
                if (Math.abs(x) > a) continue;
                const yMax = (2/5) * Math.sqrt(Math.max(0, 25 - x * x));
                const chord = 2 * yMax;
                if (chord <= 0.1) continue;

                ctx.strokeStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);

                ctx.beginPath();
                if (type === 'equilateral') {
                    const triH = chord * Math.sqrt(3) / 2;
                    const p1 = project3D(x, -yMax, 0, cx, cy, scale);
                    const p2 = project3D(x, yMax, 0, cx, cy, scale);
                    const p3 = project3D(x, 0, triH, cx, cy, scale);
                    ctx.moveTo(p1.x, p1.y);
                    ctx.lineTo(p2.x, p2.y);
                    ctx.lineTo(p3.x, p3.y);
                    ctx.closePath();
                } else {
                    // åŠåœ†
                    const r = chord / 2;
                    const segments = 24;
                    for (let i = 0; i <= segments; i++) {
                        const angle = Math.PI * i / segments;
                        const py = -r * Math.cos(angle);
                        const pz = r * Math.sin(angle);
                        const p = project3D(x, py, pz, cx, cy, scale);
                        if (i === 0) ctx.moveTo(p.x, p.y);
                        else ctx.lineTo(p.x, p.y);
                    }
                    ctx.closePath();
                }
                ctx.stroke();
                ctx.setLineDash([]);
            }

            // æ·»åŠ é«˜å…‰
            ctx.beginPath();
            for (let i = 5; i <= steps * 0.6; i++) {
                const t = i / steps;
                const x = -a + t * 2 * a;
                const yMax = (2/5) * Math.sqrt(Math.max(0, 25 - x * x));
                const chord = 2 * yMax;
                let topZ = type === 'equilateral' ? chord * Math.sqrt(3) / 2 * 0.7 : chord / 2 * 0.7;
                const p = project3D(x, yMax * 0.3, topZ, cx, cy, scale);
                if (i === 5) ctx.moveTo(p.x, p.y);
                else ctx.lineTo(p.x, p.y);
            }
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.45)';
            ctx.lineWidth = 4;
            ctx.lineCap = 'round';
            ctx.stroke();
            ctx.lineCap = 'butt';
        }

        // ç»˜åˆ¶å‚ç›´äºYè½´çš„ç«‹ä½“ï¼ˆç­‰è…°ç›´è§’ä¸‰è§’å½¢/æ­£æ–¹å½¢ï¼‰
        // æˆªé¢åœ¨ x-z å¹³é¢ï¼Œæ²¿ y æ–¹å‘å †å 
        function drawSolid3D_perpY(ctx, type, cx, cy, scale) {
            const steps = 60;

            // åœ¨æ¯ä¸ªyä½ç½®ï¼Œxçš„èŒƒå›´æ˜¯ Â±(5/2)âˆš(4-yÂ²)
            // æˆªé¢çš„åº•è¾¹ï¼ˆå¼¦é•¿ï¼‰= 5âˆš(4-yÂ²)

            // æ”¶é›†è½®å»“ç‚¹
            const topPoints = [];      // æˆªé¢é¡¶ç‚¹è½¨è¿¹
            const leftPoints = [];     // x < 0 ä¾§çš„åº•è¾¹
            const rightPoints = [];    // x > 0 ä¾§çš„åº•è¾¹

            for (let i = 0; i <= steps; i++) {
                const t = i / steps;
                const y = -b + t * 2 * b;  // yä»-2åˆ°2
                const xMax = (5/2) * Math.sqrt(Math.max(0, 4 - y * y));
                const chord = 2 * xMax;  // å¼¦é•¿ = 5âˆš(4-yÂ²)

                let topZ = 0;
                if (type === 'isosceles') {
                    topZ = chord / 2;  // ç­‰è…°ç›´è§’ä¸‰è§’å½¢ï¼ˆæ–œè¾¹ä¸ºåº•ï¼‰é«˜åº¦ = æ–œè¾¹/2
                } else {
                    topZ = chord;  // æ­£æ–¹å½¢é«˜åº¦ = è¾¹é•¿
                }

                if (type === 'isosceles') {
                    // ç­‰è…°ç›´è§’ä¸‰è§’å½¢é¡¶ç‚¹åœ¨x=0å¤„
                    topPoints.push(project3D(0, y, topZ, cx, cy, scale));
                } else {
                    // æ­£æ–¹å½¢é¡¶é¢å·¦å³ä¸¤è¾¹
                    topPoints.push({
                        left: project3D(-xMax, y, topZ, cx, cy, scale),
                        right: project3D(xMax, y, topZ, cx, cy, scale)
                    });
                }

                leftPoints.push(project3D(-xMax, y, 0, cx, cy, scale));
                rightPoints.push(project3D(xMax, y, 0, cx, cy, scale));
            }

            if (type === 'isosceles') {
                // ç­‰è…°ç›´è§’ä¸‰è§’å½¢ç«‹ä½“

                // ç»˜åˆ¶å·¦æ–œé¢ï¼ˆx < 0 åˆ°é¡¶ç‚¹ï¼‰
                ctx.beginPath();
                for (let i = 0; i <= steps; i++) {
                    const p = leftPoints[i];
                    if (i === 0) ctx.moveTo(p.x, p.y);
                    else ctx.lineTo(p.x, p.y);
                }
                for (let i = steps; i >= 0; i--) {
                    const p = topPoints[i];
                    ctx.lineTo(p.x, p.y);
                }
                ctx.closePath();

                const leftGrad = ctx.createLinearGradient(cx - 150, cy + 50, cx, cy - 150);
                leftGrad.addColorStop(0, 'rgba(52, 152, 219, 0.35)');
                leftGrad.addColorStop(1, 'rgba(41, 128, 185, 0.6)');
                ctx.fillStyle = leftGrad;
                ctx.fill();
                ctx.strokeStyle = 'rgba(41, 128, 185, 0.5)';
                ctx.lineWidth = 1;
                ctx.stroke();

                // ç»˜åˆ¶å³æ–œé¢ï¼ˆx > 0 åˆ°é¡¶ç‚¹ï¼‰
                ctx.beginPath();
                for (let i = 0; i <= steps; i++) {
                    const p = rightPoints[i];
                    if (i === 0) ctx.moveTo(p.x, p.y);
                    else ctx.lineTo(p.x, p.y);
                }
                for (let i = steps; i >= 0; i--) {
                    const p = topPoints[i];
                    ctx.lineTo(p.x, p.y);
                }
                ctx.closePath();

                const rightGrad = ctx.createLinearGradient(cx, cy + 50, cx + 150, cy - 150);
                rightGrad.addColorStop(0, 'rgba(52, 152, 219, 0.5)');
                rightGrad.addColorStop(1, 'rgba(93, 173, 226, 0.75)');
                ctx.fillStyle = rightGrad;
                ctx.fill();
                ctx.strokeStyle = 'rgba(41, 128, 185, 0.7)';
                ctx.lineWidth = 1.5;
                ctx.stroke();

                // é¡¶éƒ¨è„Šçº¿
                ctx.beginPath();
                for (let i = 0; i <= steps; i++) {
                    const p = topPoints[i];
                    if (i === 0) ctx.moveTo(p.x, p.y);
                    else ctx.lineTo(p.x, p.y);
                }
                ctx.strokeStyle = '#2980b9';
                ctx.lineWidth = 3;
                ctx.stroke();

                // ç»˜åˆ¶å‰ç«¯é¢ (yæ¥è¿‘2å¤„)
                const frontY = b * 0.9;
                const xMaxFront = (5/2) * Math.sqrt(Math.max(0, 4 - frontY * frontY));
                const chordFront = 2 * xMaxFront;
                if (chordFront > 0.5) {
                    ctx.beginPath();
                    const fp1 = project3D(-xMaxFront, frontY, 0, cx, cy, scale);
                    const fp2 = project3D(xMaxFront, frontY, 0, cx, cy, scale);
                    const fp3 = project3D(0, frontY, chordFront/2, cx, cy, scale);
                    ctx.moveTo(fp1.x, fp1.y);
                    ctx.lineTo(fp2.x, fp2.y);
                    ctx.lineTo(fp3.x, fp3.y);
                    ctx.closePath();
                    ctx.fillStyle = 'rgba(93, 173, 226, 0.6)';
                    ctx.fill();
                    ctx.strokeStyle = '#2980b9';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }

            } else {
                // æ­£æ–¹å½¢ç«‹ä½“
                // æ­£æ–¹å½¢æˆªé¢

                // ç»˜åˆ¶é¡¶é¢
                ctx.beginPath();
                for (let i = 0; i <= steps; i++) {
                    const p = topPoints[i].left;
                    if (i === 0) ctx.moveTo(p.x, p.y);
                    else ctx.lineTo(p.x, p.y);
                }
                for (let i = steps; i >= 0; i--) {
                    const p = topPoints[i].right;
                    ctx.lineTo(p.x, p.y);
                }
                ctx.closePath();

                const topGrad = ctx.createLinearGradient(cx - 50, cy - 150, cx + 50, cy - 50);
                topGrad.addColorStop(0, 'rgba(93, 173, 226, 0.9)');
                topGrad.addColorStop(1, 'rgba(52, 152, 219, 0.7)');
                ctx.fillStyle = topGrad;
                ctx.fill();
                ctx.strokeStyle = '#2980b9';
                ctx.lineWidth = 2;
                ctx.stroke();

                // ç»˜åˆ¶å³ä¾§é¢
                ctx.beginPath();
                for (let i = 0; i <= steps; i++) {
                    const p = rightPoints[i];
                    if (i === 0) ctx.moveTo(p.x, p.y);
                    else ctx.lineTo(p.x, p.y);
                }
                for (let i = steps; i >= 0; i--) {
                    const p = topPoints[i].right;
                    ctx.lineTo(p.x, p.y);
                }
                ctx.closePath();

                const sideGrad = ctx.createLinearGradient(cx + 50, cy + 50, cx + 100, cy - 100);
                sideGrad.addColorStop(0, 'rgba(52, 152, 219, 0.5)');
                sideGrad.addColorStop(1, 'rgba(41, 128, 185, 0.7)');
                ctx.fillStyle = sideGrad;
                ctx.fill();
                ctx.strokeStyle = 'rgba(41, 128, 185, 0.8)';
                ctx.lineWidth = 1.5;
                ctx.stroke();

                // ç»˜åˆ¶å·¦ä¾§é¢ï¼ˆéƒ¨åˆ†å¯è§ï¼‰
                ctx.beginPath();
                for (let i = 0; i <= steps; i++) {
                    const p = leftPoints[i];
                    if (i === 0) ctx.moveTo(p.x, p.y);
                    else ctx.lineTo(p.x, p.y);
                }
                for (let i = steps; i >= 0; i--) {
                    const p = topPoints[i].left;
                    ctx.lineTo(p.x, p.y);
                }
                ctx.closePath();

                const leftSideGrad = ctx.createLinearGradient(cx - 100, cy + 50, cx - 50, cy - 100);
                leftSideGrad.addColorStop(0, 'rgba(41, 128, 185, 0.4)');
                leftSideGrad.addColorStop(1, 'rgba(52, 152, 219, 0.5)');
                ctx.fillStyle = leftSideGrad;
                ctx.fill();
                ctx.strokeStyle = 'rgba(41, 128, 185, 0.5)';
                ctx.lineWidth = 1;
                ctx.stroke();
            }

            // ç»˜åˆ¶å‡ ä¸ªä»£è¡¨æ€§çš„æˆªé¢åˆ‡ç‰‡ï¼ˆæ²¿yæ–¹å‘ï¼‰
            const slicePositions = [-1.2, 0, 1.2];
            for (const yPos of slicePositions) {
                if (Math.abs(yPos) > b) continue;
                const xMax = (5/2) * Math.sqrt(Math.max(0, 4 - yPos * yPos));
                const chord = 2 * xMax;
                if (chord <= 0.1) continue;

                ctx.strokeStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);

                ctx.beginPath();
                if (type === 'isosceles') {
                    const topZ = chord / 2;
                    const p1 = project3D(-xMax, yPos, 0, cx, cy, scale);
                    const p2 = project3D(xMax, yPos, 0, cx, cy, scale);
                    const p3 = project3D(0, yPos, topZ, cx, cy, scale);
                    ctx.moveTo(p1.x, p1.y);
                    ctx.lineTo(p2.x, p2.y);
                    ctx.lineTo(p3.x, p3.y);
                    ctx.closePath();
                } else {
                    const topZ = chord;
                    const p1 = project3D(-xMax, yPos, 0, cx, cy, scale);
                    const p2 = project3D(xMax, yPos, 0, cx, cy, scale);
                    const p3 = project3D(xMax, yPos, topZ, cx, cy, scale);
                    const p4 = project3D(-xMax, yPos, topZ, cx, cy, scale);
                    ctx.moveTo(p1.x, p1.y);
                    ctx.lineTo(p2.x, p2.y);
                    ctx.lineTo(p3.x, p3.y);
                    ctx.lineTo(p4.x, p4.y);
                    ctx.closePath();
                }
                ctx.stroke();
                ctx.setLineDash([]);
            }

            // æ·»åŠ é«˜å…‰æ•ˆæœ
            ctx.beginPath();
            const highlightSteps = steps * 0.5;
            for (let i = 5; i <= highlightSteps; i++) {
                const t = 0.2 + i / steps * 0.6;
                const yPos = -b + t * 2 * b;
                const xMax = (5/2) * Math.sqrt(Math.max(0, 4 - yPos * yPos));
                const chord = 2 * xMax;
                let topZ = type === 'isosceles' ? chord / 2 * 0.7 : chord * 0.8;
                const xOffset = type === 'isosceles' ? xMax * 0.2 : xMax * 0.5;
                const p = project3D(xOffset, yPos, topZ, cx, cy, scale);
                if (i === 5) ctx.moveTo(p.x, p.y);
                else ctx.lineTo(p.x, p.y);
            }
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.4)';
            ctx.lineWidth = 4;
            ctx.lineCap = 'round';
            ctx.stroke();
            ctx.lineCap = 'butt';
        }

        // æ›´æ–°è®¡ç®—ä¿¡æ¯
        function updateCalcInfo(type, pos) {
            const info = {
                'equilateral': {
                    name: 'ç­‰è¾¹ä¸‰è§’å½¢æˆªé¢ (å‚ç›´äºxè½´)',
                    chord: `2y = (4/5)âˆš(25-xÂ²)`,
                    area: `A(x) = (âˆš3/4) Ã— [(4/5)âˆš(25-xÂ²)]Â² = (4âˆš3/25)(25-xÂ²)`,
                    integral: `V = âˆ«â‚‹â‚…âµ (4âˆš3/25)(25-xÂ²) dx`
                },
                'semicircle': {
                    name: 'åŠåœ†æˆªé¢ (å‚ç›´äºxè½´)',
                    chord: `ç›´å¾„ = 2y = (4/5)âˆš(25-xÂ²)ï¼ŒåŠå¾„ r = (2/5)âˆš(25-xÂ²)`,
                    area: `A(x) = (Ï€/2)rÂ² = (Ï€/2) Ã— [(2/5)âˆš(25-xÂ²)]Â² = (2Ï€/25)(25-xÂ²)`,
                    integral: `V = âˆ«â‚‹â‚…âµ (2Ï€/25)(25-xÂ²) dx`
                },
                'isosceles': {
                    name: 'ç­‰è…°ç›´è§’ä¸‰è§’å½¢æˆªé¢ (å‚ç›´äºyè½´ï¼Œæ–œè¾¹ä¸ºåº•)',
                    chord: `æ–œè¾¹ = 2x = 5âˆš(4-yÂ²)`,
                    area: `A(y) = (æ–œè¾¹Â²)/4 = [5âˆš(4-yÂ²)]Â²/4 = (25/4)(4-yÂ²)`,
                    integral: `V = âˆ«â‚‹â‚‚Â² (25/4)(4-yÂ²) dy`
                },
                'square': {
                    name: 'æ­£æ–¹å½¢æˆªé¢ (å‚ç›´äºyè½´)',
                    chord: `è¾¹é•¿ = 2x = 5âˆš(4-yÂ²)`,
                    area: `A(y) = è¾¹é•¿Â² = [5âˆš(4-yÂ²)]Â² = 25(4-yÂ²)`,
                    integral: `V = âˆ«â‚‹â‚‚Â² 25(4-yÂ²) dy`
                }
            };

            const data = info[type];
            calcInfo.innerHTML = `
                <h3 style="color: #667eea; margin-bottom: 16px;">${data.name}</h3>
                <p><strong>ç¬¬ä¸€æ­¥ï¼šæ±‚å¼¦é•¿ï¼ˆæˆªé¢çš„è¾¹ï¼‰</strong></p>
                <div class="formula">${data.chord}</div>
                <p><strong>ç¬¬äºŒæ­¥ï¼šæ±‚æˆªé¢é¢ç§¯ A</strong></p>
                <div class="formula">${data.area}</div>
                <p><strong>ç¬¬ä¸‰æ­¥ï¼šå»ºç«‹ç§¯åˆ†</strong></p>
                <div class="formula" style="font-size: 22px; color: #e74c3c;">${data.integral}</div>
            `;
        }

        // äº‹ä»¶ç›‘å¬
        sectionType.addEventListener('change', () => {
            slicePos.value = 0;
            update();
        });
        slicePos.addEventListener('input', update);

        // åˆå§‹åŒ–
        update();
    </script>
</body>
</html>
